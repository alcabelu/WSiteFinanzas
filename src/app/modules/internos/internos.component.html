<div [@routerTransition]>
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header bg-primary text-white text-center">
          FILTROS
          <button type="button" class="btn btn-primary text-white btn-sm btn-vm" (click)='toggleFilters()'>
            <span class="fa fa-caret-down" title="Toggle dropdown menu"></span>
          </button>
        </div>
        <div class="card-body" *ngIf='showFilters' @ngIfAnimation>
          <form>
            <div class="form-row">
              <div class="form-group col-md-5">
                <label for="inputCompania">Compañía</label>
                <select name="inputCompania" class="form-control form-control-sm" [(ngModel)]="selectedCompania" (ngModelChange)="onChangeCompania($event)">
                  <option value="0">Seleccione Compañía</option>
                  <option *ngFor="let compania of companias" [value]="compania.ID">
                    {{ compania.NOMBRE }}
                  </option>
                </select>
              </div>
              <div class="form-group col-md-4">
                <label for="inputPeriodo">Periodo</label>
                <input type="month" name="inputPeriodo" class="form-control form-control-sm"
                  min="1960-01"
                  [value]='periodo'
                  (input)='onChangePeriodo($event.target.value)'>
              </div>
              <div class="form-group col-md-3">
                <label for="inputTipoReporte">Estado de Resultados</label>
                <select name="inputTipoReporte" class="form-control form-control-sm"
                  ([ngModel])='selectedTipoReporte'
                  (change)='onChangeTipoReporte($event.target.value)'>
                  <option *ngFor='let tipo of tipoReporte' [value]='tipo.Id'>
                    {{ tipo.Descripcion }}
                  </option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-5">
                <label for="inputSucursal">Sucursal</label>
                <select name="inputSucursal" class="form-control form-control-sm"
                  [disabled]="!showReporteUnidades ? '' : null"
                  [(ngModel)]='selectedSucursal'
                  (ngModelChange)='onChangeSucursal($event)'>
                  <option *ngFor="let sucursal of sucursales" [value]="sucursal.MSUC">
                    {{ sucursal.Alias }}
                  </option>
                </select>
              </div>
              <div class="form-group col-md-4">
                <label for="inputDepartamento">Departamento</label>
                <select name="inputDepartamento" class="form-control form-control-sm"
                  [disabled]="!showReporteUnidades ? '' : null"
                  [(ngModel)]='selectedDepartamento'
                  (ngModelChange)='onChangeDepartamento($event)'>
                  <option *ngIf='departamentos.length > 0' value="Todos">Todos</option>
                  <option *ngFor='let depto of departamentos' [value]='depto.Depto'>
                    {{ depto.Departamento }}
                  </option>
                </select>
              </div>
              <div class="form-group col-md-2 d-flex align-items-end">
                <button type="button" class="btn btn-primary btn-sm" id="submit" (click)='procesar()'>Procesar</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf='showReporteUnidades' class="row">
    <div class="col-md-12 mt-2">
      <div class="card">
        <div class="card-header bg-primary text-white text-center">
          UNIDADES
          <button type="button" class="btn btn-primary text-white btn-sm btn-vm" (click)='toggleUnidades()'>
            <span class="fa fa-caret-down" title="Toggle dropdown menu"></span>
          </button>
        </div>
        <table *ngIf='showUnidades' class="table table-sm table-bordered">
          <thead>
            <tr>
              <th class="bg-secondary text-white col-width-concepto">Concepto</th>
              <th class="bg-primary text-white col-width-cantidad">Real</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-primary text-white col-width-perc">PPto</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-primary text-white col-width-cantidad">Variación</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">Real</th>
              <th class="bg-success text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-perc">PPto</th>
              <th class="bg-success text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">Variación</th>
              <th class="bg-success text-white col-width-perc">%</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor='let r of resultadoUnidades'>
              <td>{{ r.Concepto }}</td>
              <td>{{ r.Real }}</td>
              <td>{{ r.Perc1 | number:'1.2-2' }}</td>
              <td>{{ r.PPto }}</td>
              <td>{{ r.Perc2 | number:'1.2-2' }}</td>
              <td>{{ r.Variacion }}</td>
              <td>{{ r.Perc3 | number:'1.2-2' }}</td>
              <td>{{ r.AcReal }}</td>
              <td>{{ r.AcPerc1 | number:'1.2-2' }}</td>
              <td>{{ r.AcPPto }}</td>
              <td>{{ r.AcPerc2 | number:'1.2-2' }}</td>
              <td>{{ r.AcVariacion }}</td>
              <td>{{ r.AcPerc3 | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div *ngIf='showReporteUnidades' class="row">
    <div class="col-md-12 mt-2">
      <div class="card">
        <div class="card-header bg-primary text-white text-center">
          UNIDADES
          <button type="button" class="btn btn-primary text-white btn-sm btn-vm" (click)='toggleUnidadesDepartamento()'>
            <span class="fa fa-caret-down" title="Toggle dropdown menu"></span>
          </button>
        </div>
        <table *ngIf='showUnidadesDepartamento' class="table table-sm table-bordered">
          <thead>
            <tr>
              <th class="bg-secondary text-white col-width-concepto">Concepto</th>
              <th class="bg-primary text-white col-width-cantidad">Real</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-primary text-white col-width-perc">PPto</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-primary text-white col-width-cantidad">Variación</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">Real</th>
              <th class="bg-success text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-perc">PPto</th>
              <th class="bg-success text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">Variación</th>
              <th class="bg-success text-white col-width-perc">%</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor='let r of unidadesDepartamento'>
              <td>{{ r.Concepto }}</td>
              <td>{{ r.Real }}</td>
              <td>{{ r.Perc1 | number:'1.2-2' }}</td>
              <td>{{ r.PPto }}</td>
              <td>{{ r.Perc2 | number:'1.2-2' }}</td>
              <td>{{ r.Variacion }}</td>
              <td>{{ r.Perc3 | number:'1.2-2' }}</td>
              <td>{{ r.AcReal }}</td>
              <td>{{ r.AcPerc1 | number:'1.2-2' }}</td>
              <td>{{ r.AcPPto }}</td>
              <td>{{ r.AcPerc2 | number:'1.2-2' }}</td>
              <td>{{ r.AcVariacion }}</td>
              <td>{{ r.AcPerc3 | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div *ngIf='showReporteUnidades' class="row">
    <div class="col-md-12 mt-2">
      <div class="card">
        <div class="card-header bg-primary text-white text-center">
          ESTADO DE RESULTADOS
          <button type="button" class="btn btn-primary text-white btn-sm btn-vm" (click)='toggleResultados()'>
            <span class="fa fa-caret-down" title="Toggle dropdown menu"></span>
          </button>
        </div>
        <table *ngIf='showResultados && !showDetalleResultados' class="table table-sm table-bordered table-fixed table-hover-td">
          <thead>
            <tr>
              <th class="bg-secondary text-white col-width-concepto">Concepto</th>
              <th class="bg-primary text-white col-width-cantidad">Real</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-primary text-white col-width-cantidad">PPto</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-primary text-white col-width-cantidad">Variación</th>
              <th class="bg-primary text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">Real</th>
              <th class="bg-success text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">PPto</th>
              <th class="bg-success text-white col-width-perc">%</th>
              <th class="bg-success text-white col-width-cantidad">Variación</th>
              <th class="bg-success text-white col-width-perc">%</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor='let r of estadoResultados; let i = index;'>
              <tr [ngClass]="{'font-weight-bold': i === 2 || i === 4 || i === 8 || i === 10 || i === 15 || i === 19 || i === 21 || i === 22 || i === 23 || i === 24 || i === 25 || i === 26}">
                <td class="col-width-concepto">{{ r.Concepto }}</td>
                <td class="text-right col-width-cantidad" (click)="onClickCell(i, r.Real, 'Real')">
                  {{ r.Real | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-perc">
                  {{ r.Perc1 | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-cantidad" (click)="onClickCell(i, r.PPto, 'PPto')">
                  {{ r.PPto | number:'1.2-2'}}
                </td>
                <td class="text-right col-width-perc">
                  {{ r.Perc2 | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-cantidad" (click)="onClickCell(i, r.Variacion, 'Variacion')">
                  {{ r.Variacion | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-perc">
                  {{ r.Perc3 | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-cantidad" (click)="onClickCell(i, r.AcReal, 'AcReal')">
                  {{ r.AcReal | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-perc">
                  {{ r.AcPerc1 | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-cantidad" (click)="onClickCell(i, r.AcPPto, 'AcPPto')">
                  {{ r.AcPPto | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-perc">
                  {{ r.AcPerc2 | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-cantidad" (click)="onClickCell(i, r.AcVariacion, 'AcVariacion')">
                  {{ r.AcVariacion | number:'1.2-2' }}
                </td>
                <td class="text-right col-width-perc">
                  {{ r.AcPerc3 | number:'1.2-2' }}
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>

        <!-- BEGIN Detalle de Resultados -->
        <div *ngIf='showDetalleResultados' class="card-body">
          <button type="button" class="close" (click)='showDetalleResultados = false'>
            <span>&times;</span>
          </button>
          <p><b>Concepto:</b> {{ detalleConcepto }} <b>{{ detalleName }}:</b> {{ detalleValue | number:'1.2-2' }}</p>
          <table class="table table-sm table-bordered table-fixed">
            <thead>
              <tr>
                <th class="bg-secondary text-white col-md-4">No. Cuenta</th>
                <th class="bg-secondary text-white col-md-4">Descripción</th>
                <th class="bg-secondary text-white col-md-4">Saldo Mensual</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="col-md-4">4003-0030-0001-0008</td>
                <td class="col-md-4">Ventas de S-CROSS GL </td>
                <td class="col-md-4">855,547.61</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0014</td>
                <td class="col-md-4">Ventas de CIAZ</td>
                <td class="col-md-4">431,017.25</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0015</td>
                <td class="col-md-4">VENTAS DE IGNIS GLX</td>
                <td class="col-md-4">1,599,068.97</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0002-0005</td>
                <td class="col-md-4">Ventas de NUEVA VITARA</td>
                <td class="col-md-4">1,172,719.03</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0001</td>
                <td class="col-md-4">Ventas de SWIFT GA</td>
                <td class="col-md-4">3,735,983.92</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0008</td>
                <td class="col-md-4">Ventas de S-CROSS GL </td>
                <td class="col-md-4">855,547.61</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0014</td>
                <td class="col-md-4">Ventas de CIAZ</td>
                <td class="col-md-4">230,445.54</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0015</td>
                <td class="col-md-4">VENTAS DE IGNIS GLX</td>
                <td class="col-md-4">2,629,198.29</td>
              </tr>
              <tr>
                <td class="col-md-4">4602-0030-0006-0005</td>
                <td class="col-md-4">Dev.Desc. s/ Ventas de NUEVA VITARA</td>
                <td class="col-md-4">-22,606.89</td>
              </tr>
              <tr>
                <td class="col-md-4">4603-0030-0001-0090</td>
                <td class="col-md-4">Dev.Desc. s/ Ventas/Otras vtas</td>
                <td class="col-md-4">-101,803.54</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0008</td>
                <td class="col-md-4">Ventas de S-CROSS GL </td>
                <td class="col-md-4">855,547.61</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0014</td>
                <td class="col-md-4">Ventas de CIAZ</td>
                <td class="col-md-4">431,017.25</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0015</td>
                <td class="col-md-4">VENTAS DE IGNIS GLX</td>
                <td class="col-md-4">1,599,068.97</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0002-0005</td>
                <td class="col-md-4">Ventas de NUEVA VITARA</td>
                <td class="col-md-4">1,172,719.03</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0001</td>
                <td class="col-md-4">Ventas de SWIFT GA</td>
                <td class="col-md-4">3,735,983.92</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0008</td>
                <td class="col-md-4">Ventas de S-CROSS GL </td>
                <td class="col-md-4">855,547.61</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0014</td>
                <td class="col-md-4">Ventas de CIAZ</td>
                <td class="col-md-4">230,445.54</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0015</td>
                <td class="col-md-4">VENTAS DE IGNIS GLX</td>
                <td class="col-md-4">2,629,198.29</td>
              </tr>
              <tr>
                <td class="col-md-4">4602-0030-0006-0005</td>
                <td class="col-md-4">Dev.Desc. s/ Ventas de NUEVA VITARA</td>
                <td class="col-md-4">-22,606.89</td>
              </tr>
              <tr>
                <td class="col-md-4">4603-0030-0001-0090</td>
                <td class="col-md-4">Dev.Desc. s/ Ventas/Otras vtas</td>
                <td class="col-md-4">-101,803.54</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0008</td>
                <td class="col-md-4">Ventas de S-CROSS GL </td>
                <td class="col-md-4">855,547.61</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0014</td>
                <td class="col-md-4">Ventas de CIAZ</td>
                <td class="col-md-4">431,017.25</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0001-0015</td>
                <td class="col-md-4">VENTAS DE IGNIS GLX</td>
                <td class="col-md-4">1,599,068.97</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0002-0005</td>
                <td class="col-md-4">Ventas de NUEVA VITARA</td>
                <td class="col-md-4">1,172,719.03</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0001</td>
                <td class="col-md-4">Ventas de SWIFT GA</td>
                <td class="col-md-4">3,735,983.92</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0008</td>
                <td class="col-md-4">Ventas de S-CROSS GL </td>
                <td class="col-md-4">855,547.61</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0014</td>
                <td class="col-md-4">Ventas de CIAZ</td>
                <td class="col-md-4">230,445.54</td>
              </tr>
              <tr>
                <td class="col-md-4">4003-0030-0003-0015</td>
                <td class="col-md-4">VENTAS DE IGNIS GLX</td>
                <td class="col-md-4">2,629,198.29</td>
              </tr>
              <tr>
                <td class="col-md-4">4602-0030-0006-0005</td>
                <td class="col-md-4">Dev.Desc. s/ Ventas de NUEVA VITARA</td>
                <td class="col-md-4">-22,606.89</td>
              </tr>
              <tr>
                <td class="col-md-4">4603-0030-0001-0090</td>
                <td class="col-md-4">Dev.Desc. s/ Ventas/Otras vtas</td>
                <td class="col-md-4">-101,803.54</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- END Detalle de resultados -->
      </div>
    </div>
  </div>
  <div *ngIf='showEfectivoSituacion' class="row">
    <div class="col-md-12 mt-2">
      <div class="card">
        <div class="card-header bg-primary text-white text-center">
          FLUJO DE EFECTIVO REAL
        </div>
        <table class="table table-sm table-bordered table-responsive">
          <thead>
            <tr>
              <th class="bg-success text-white">Concepto</th>
              <th class="bg-success text-white">Ene</th>
              <th class="bg-success text-white">Feb</th>
              <th class="bg-success text-white">Mar</th>
              <th class="bg-success text-white">Abr</th>
              <th class="bg-success text-white">May</th>
              <th class="bg-success text-white">Jun</th>
              <th class="bg-success text-white">Jul</th>
              <th class="bg-success text-white">Ago</th>
              <th class="bg-success text-white">Sep</th>
              <th class="bg-success text-white">Oct</th>
              <th class="bg-success text-white">Nov</th>
              <th class="bg-success text-white">Dic</th>
              <th *ngIf="selectedTipoReporte === '5'" class="bg-success text-white">DicAñoAnt</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor='let es of efectivoSituacion; let i = index;'>
              <tr>
                <td class="">{{ es.Concepto }}</td>
                <td class="text-right">{{ es.Ene | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Feb | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Mar | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Abr | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.May | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Jun | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Jul | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Ago | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Sep | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Oct | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Nov | number:'1.2-2' }}</td>
                <td class="text-right">{{ es.Dic | number:'1.2-2' }}</td>
                <td *ngIf="selectedTipoReporte === '5'" class="text-right">{{ es.SaldoINI | number:'1.2-2' }}</td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
